<admintpl file="header"/>

</head>
<style>

</style>
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <volist name="class" id="vo">
            <li  <if condition="$class_id eq $vo['class_id']">class="active"</if>><a href="{:U('TeaGrade/index',array('id'=>$vo['class_id']))}">{$vo.class_no}</a></li>
        </volist>
       <!-- <li  class="active"><a href="{:U('Teamm/index')}">教师信息</a></li>
        <li><a href="{:U('Teamm/add')}">添加</a></li>-->
    </ul>
    <form  method="post" action="{:U('TeaGrade/grade')}">
        <button class="btn btn-danger btn-small js-ajax-submit" type="submit" data-action="{:U('TeaGrade/grade')}"
                data-subcheck="true" data-msg="{:L('DELETE_CONFIRM_MESSAGE')}">提交
        </button>
        <table class="table table-hover table-bordered table-list" style="width:120%;">
            <thead>
            <tr>
                <th>学生学号</th>
                <th>学生姓名</th>
                <th>成绩</th>
            </tr>
            </thead>
            <tbody>
            <foreach name="stu_list" item="vo">
                <tr>
                    <td>{$vo.stu_no}</td>
                    <td>{$vo.stu_name}</td>
                    <td><input type="number" name="grade[]" value="{$vo.grade}">
                        <input type="hidden" name="stu_id[]" value="{$vo.stu_id}">
                        <input type="hidden" name="grade_id[]" value="{$vo.grade_id}">
                    </td>
                </tr>
            </foreach>
            </tbody>
        </table>
        <button class="btn btn-danger btn-small js-ajax-submit" type="submit" data-action="{:U('TeaGrade/grade')}"
                data-subcheck="true" data-msg="{:L('DELETE_CONFIRM_MESSAGE')}">提交
        </button>
    </form>

</div>
</body>
<script src="__PUBLIC__/js/common.js"></script>
<script>

    $(".update").on("click", function () {
        var span = $(this).find("span").html();
        $.ajax({
                   type: "POST",
                   url:"{:U('Teamm/get_data')}",
                   dataType:"json",
                   data: {
                       'teacher_id': span
                   },
                   success: function(data){
//                       console.log(data);
                       $('#up_name').val(data.teacher_name);
                       $('#up_id').val(data.teacher_id);
                       $('#up_subj').val(data.subject_id);
                       $("#up_depart").append("<option value='" + data.depart_id + "'>" + data.dep + "</option>");
                       $('#_class').html(data.class_no);
                       $('#up_div').slideToggle("slow");
                   }
               }).responseText;
    });

    //修改三级联动
    function up_change() {
        sub_id = $("#up_subj").val();
        $("#up_depart").text(" ");
        $.ajax({
                   type: "POST",
                   url: "{:U('Teamm/change')}",
                   dataType: "json",
                   data: {
                       'subject_id': sub_id
                   },
                   success: function (data) {
                       delete data['state'];
                       delete data['referer'];
                       $.each(data, function (name, value) {
                           var depart_name = value.depart_name;
                           var depart_id = value.depart_id;
                           $("#up_depart").append("<option value='" + depart_id + "'>" + depart_name + "</option>");
                       })
                       up_change_two();
                   }
               }).responseText;
    }

    function up_change_two() {
        depart_id = $("#up_depart").val();
        $("#_class").text(' ');
        $.ajax({
                   type: "POST",
                   url:"{:U('Stumm/change_two')}",
                   dataType:"json",
                   data: {
                       'depart_id': depart_id
                   },
                   success: function(data){
                       delete data['state'];
                       delete data['referer'];
                       $.each(data,function(name,value){
                           var class_no = value.class_no;
                           var class_id = value.class_id;
                           $("#_class").append("<input type='checkbox' name='cls[]' value='" + class_id + "' class='__class'/>"+ class_no);
                       })
                   }
               }).responseText;
    }

    //修改
    /* $("#up_sub").on("click",function(){
     name = $('#up_name').val();
     sub = $('#up_subj').val();
     depart = $('#up_depart').val();
     alert($("#_class").html());
     id = $('#up_id').val();
     $.ajax({
     type: "POST",
     url:"{:U('Teamm/up_data')}",
     dataType:"json",
     data: {
     'teacher_id': id,
     'teacher_name': name,
     'subject_id': sub,
     'depart_id': depart,
     'class_id': class1,
     },
     success: function(data){
     alert(data.info);
     }
     }).responseText;
     })*/
</script>
</html>
